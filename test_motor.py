from gpiozero import Motor, OutputDevice
from time import sleep
import sys

print("üîß –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ú–û–¢–û–†–û–í –ò –î–†–ê–ô–í–ï–†–û–í IBT-2")
print("=" * 50)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ—Ç–æ—Ä–æ–≤
# –§–æ—Ä–º–∞—Ç: Motor(forward, backward) - –ø–∏–Ω—ã –¥–ª—è –ø–µ—Ä–µ–¥–Ω–µ–≥–æ –∏ –∑–∞–¥–Ω–µ–≥–æ —Ö–æ–¥–∞
# –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ –∂–µ –ø–∏–Ω—ã, —á—Ç–æ –∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ
left_motor = Motor(forward=12, backward=13)
right_motor = Motor(forward=19, backward=18)

def test_single_motor(motor, motor_name):
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ–¥–∏–Ω –º–æ—Ç–æ—Ä –≤–æ –≤—Å–µ—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö"""
    print(f"\nüîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º {motor_name} –º–æ—Ç–æ—Ä...")
    
    try:
        # –í–ø–µ—Ä–µ–¥ –Ω–∞ 2 —Å–µ–∫—É–Ω–¥—ã
        print(f"‚ñ∂Ô∏è  {motor_name} –º–æ—Ç–æ—Ä: –í–ü–ï–†–ï–î (50% —Å–∫–æ—Ä–æ—Å—Ç–∏)")
        motor.forward(0.5)
        sleep(2)
        
        # –°—Ç–æ–ø
        print("‚èπÔ∏è  –°—Ç–æ–ø")
        motor.stop()
        sleep(1)
        
        # –ù–∞–∑–∞–¥ –Ω–∞ 2 —Å–µ–∫—É–Ω–¥—ã
        print(f"‚óÄÔ∏è  {motor_name} –º–æ—Ç–æ—Ä: –ù–ê–ó–ê–î (50% —Å–∫–æ—Ä–æ—Å—Ç–∏)")
        motor.backward(0.5)
        sleep(2)
        
        # –°—Ç–æ–ø
        print("‚èπÔ∏è  –°—Ç–æ–ø")
        motor.stop()
        sleep(1)
        
        # –ü–ª–∞–≤–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥
        print(f"üéöÔ∏è  {motor_name} –º–æ—Ç–æ—Ä: –ü–ª–∞–≤–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥")
        for speed in [0.1, 0.3, 0.5, 0.7, 0.9]:
            motor.forward(speed)
            print(f"   –°–∫–æ—Ä–æ—Å—Ç—å: {int(speed*100)}%")
            sleep(1)
        
        motor.stop()
        sleep(1)
        
        print(f"‚úÖ {motor_name} –º–æ—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!")
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å {motor_name} –º–æ—Ç–æ—Ä–æ–º: {e}")
        return False

def test_both_motors():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ–±–∞ –º–æ—Ç–æ—Ä–∞ –≤–º–µ—Å—Ç–µ"""
    print("\nüîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–±–∞ –º–æ—Ç–æ—Ä–∞ –≤–º–µ—Å—Ç–µ...")
    
    try:
        # –û–±–∞ –≤–ø–µ—Ä–µ–¥
        print("üîº –û–±–∞ –º–æ—Ç–æ—Ä–∞: –í–ü–ï–†–ï–î")
        left_motor.forward(0.6)
        right_motor.forward(0.6)
        sleep(3)
        
        # –û–±–∞ –Ω–∞–∑–∞–¥
        print("üîΩ –û–±–∞ –º–æ—Ç–æ—Ä–∞: –ù–ê–ó–ê–î")
        left_motor.backward(0.6)
        right_motor.backward(0.6)
        sleep(3)
        
        # –†–∞–∑–≤–æ—Ä–æ—Ç –≤–ª–µ–≤–æ
        print("‚Ü©Ô∏è  –†–∞–∑–≤–æ—Ä–æ—Ç –í–õ–ï–í–û")
        left_motor.backward(0.5)
        right_motor.forward(0.5)
        sleep(2)
        
        # –†–∞–∑–≤–æ—Ä–æ—Ç –≤–ø—Ä–∞–≤–æ
        print("‚Ü™Ô∏è  –†–∞–∑–≤–æ—Ä–æ—Ç –í–ü–†–ê–í–û")
        left_motor.forward(0.5)
        right_motor.backward(0.5)
        sleep(2)
        
        # –°—Ç–æ–ø
        left_motor.stop()
        right_motor.stop()
        
        print("‚úÖ –û–±–∞ –º–æ—Ç–æ—Ä–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–º–µ—Å—Ç–µ!")
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ –º–æ—Ç–æ—Ä–æ–≤: {e}")
        return False

def main():
    print("–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:")
    print("–õ–µ–≤—ã–π –º–æ—Ç–æ—Ä: GPIO 12 (–≤–ø–µ—Ä–µ–¥), GPIO 13 (–Ω–∞–∑–∞–¥)")
    print("–ü—Ä–∞–≤—ã–π –º–æ—Ç–æ—Ä: GPIO 19 (–≤–ø–µ—Ä–µ–¥), GPIO 18 (–Ω–∞–∑–∞–¥)")
    print("\n–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:")
    print("1. –î—Ä–∞–π–≤–µ—Ä—ã IBT-2 –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ 3.3V –¥–ª—è R_EN –∏ L_EN")
    print("2. –ú–æ—Ç–æ—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –æ—Ç–¥–µ–ª—å–Ω–æ–º—É –ø–∏—Ç–∞–Ω–∏—é")
    print("3. –í—Å–µ GND —Å–æ–µ–¥–∏–Ω–µ–Ω—ã")
    
    input("\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...")
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏
    left_ok = test_single_motor(left_motor, "–õ–ï–í–´–ô")
    right_ok = test_single_motor(right_motor, "–ü–†–ê–í–´–ô")
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–º–µ—Å—Ç–µ
    if left_ok and right_ok:
        both_ok = test_both_motors()
    else:
        both_ok = False
        print("\n‚ùå –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –æ–±–æ–∏—Ö –º–æ—Ç–æ—Ä–æ–≤ –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ –≤ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö")
    
    # –ò—Ç–æ–≥–∏
    print("\n" + "=" * 50)
    print("üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:")
    print(f"–õ–µ–≤—ã–π –º–æ—Ç–æ—Ä: {'‚úÖ –†–ê–ë–û–¢–ê–ï–¢' if left_ok else '‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢'}")
    print(f"–ü—Ä–∞–≤—ã–π –º–æ—Ç–æ—Ä: {'‚úÖ –†–ê–ë–û–¢–ê–ï–¢' if right_ok else '‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢'}")
    print(f"–°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞: {'‚úÖ –†–ê–ë–û–¢–ê–ï–¢' if both_ok else '‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢'}")
    
    if left_ok and right_ok and both_ok:
        print("\nüéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´! –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–æ WASD!")
    else:
        print("\n‚ö†Ô∏è  –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º WASD —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.")

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n‚èπÔ∏è  –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        left_motor.stop()
        right_motor.stop()
    finally:
        # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ—Ç–æ—Ä–æ–≤
        left_motor.stop()
        right_motor.stop()
        print("\nüî¥ –í—Å–µ –º–æ—Ç–æ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã")